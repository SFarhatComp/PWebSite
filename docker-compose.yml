version: '3'

services:
  frontend:
    image: node:16
    working_dir: /app
    volumes:
      - .:/app
    command: >
      bash -c "
        mkdir -p public static &&
        [ ! -f public/index.html ] && echo '<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>CV Website</title></head><body><div id=\"root\"></div></body></html>' > public/index.html || true &&
        npm install &&
        npm run build
      "
    
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    ports:
      - "5000:5000"
    environment:
      - EMAIL_USER=${EMAIL_USER}
      - EMAIL_PASS=${EMAIL_PASS}
      - RECIPIENT_EMAIL=${RECIPIENT_EMAIL}
    volumes:
      - ./static:/app/static
      - ./build:/app/build
    depends_on:
      - frontend 